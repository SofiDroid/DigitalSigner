<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name = "dataSet" />
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>        
        <p:dataTable id="#{cc.attrs.id}" widgetVar="#{cc.attrs.id}" var="itemRow" value="#{cc.attrs.dataSet.rows}" 
                     style="width:100%;padding:0.2rem" size="small"
                     selection="#{cc.attrs.dataSet.selectedRows}" rowKey="#{itemRow.id}"
                     paginator="true" rows="#{cc.attrs.dataSet.rowsPerPage}" selectionPageOnly="false"
                     paginatorPosition="bottom" paginatorAlwaysVisible="false"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros">
            <p:column rendered="#{cc.attrs.dataSet.selectable}" selectionMode="multiple" style="width:16px;text-align:center"/>
            <p:columns value="#{cc.attrs.dataSet.cabecera.columns}" columnIndexVar="indexCol" var="itemColumn"
                       headerText="#{itemColumn.title}" visible="#{itemColumn.visible}" width="#{itemColumn.width}"
                       style="text-align: #{itemColumn.align}"
                       sortable="true" sortBy="#{itemRow.getColumnName(itemColumn.name)[itemColumn.valueProperty]}">
                <p:column>
                    <p:outputPanel rendered="#{itemColumn.tipo eq 'TEXTO'}">
                        <span title="#{itemRow.getColumnName(itemColumn.name).tooltip}">
                            #{itemRow.getColumnName(itemColumn.name)[itemColumn.valueString]}
                        </span>
                    </p:outputPanel>
                    <p:outputPanel rendered="#{itemColumn.tipo eq 'LINK'}">
                        <p:commandLink id="btnLink"
                                title="#{itemRow.getColumnName(itemColumn.name).tooltip}"
                                value="#{itemRow.getColumnName(itemColumn.name)[itemColumn.valueString]}"
                                action="#{itemColumn.ejecutarMetodo}"
                                update="#{itemColumn.update}">
                            <f:setPropertyActionListener target="#{cc.attrs.dataSet.selectedRow}" value="#{itemRow}" />
                        </p:commandLink>
                    </p:outputPanel>
                    <p:outputPanel rendered="#{itemColumn.tipo eq 'MEDIA'}">
                        <p:commandButton                                 title="#{itemRow.getColumnName(itemColumn.name).tooltip}"
                                value="#{itemRow.getColumnName(itemColumn.name)[itemColumn.valueString]}"
                                action="#{itemColumn.ejecutarMetodo}"
                                update="@widgetVar(#{cc.attrs.id}_visorMedia),#{itemColumn.update}" oncomplete="PF('#{cc.attrs.id}_visorMedia').show()"
                                icon="pi pi-file-pdf" styleClass="button-inline">
                            <f:setPropertyActionListener target="#{cc.attrs.dataSet.selectedRow}" value="#{itemRow}" />
                        </p:commandButton>
                    </p:outputPanel>
                </p:column>
            </p:columns>
        </p:dataTable>
        <p:dialog id="#{cc.attrs.id}_visorMedia" widgetVar="#{cc.attrs.id}_visorMedia"
                  modal="true" width="70%" height="500px" header="Visor de documentos" >
            <p:media value="/documento.pdf" height="480px" player="pdf" cache="false"
                     width="100%">
                Your browser can't display pdf.
            </p:media>
        </p:dialog>
    </cc:implementation>
</html>